# Склад
## 1. Введение
Проект представляет собой бэкэнд часть пункта выдачи товара.
## 2. Стек  
Spring boot, mysql, docker
## 3. Функционал
Есть 2 роли - покупатель и продавец.  
Возможности покупателя:  
1. Посмотреть товары в продаже.  
2. Сделать заказ.  
 
Возможности продавца:  
1. Посмотреть/добавить/изменить/удалить товары.
2. Удалить/изменить заказ.  

## 4. Как запустить
Нужно скачать docker-compose.yml файл и выполнить команду в docker  
```
cd <путь до файла> && docker-compose up
```
## 5. Инструкция как работает
### Авторизация
Для начала нужно авторизоваться - получить токен для дальнейших запросов.  
Нужно отправить POST запрос на адрес "/api/login".  
Пример  
```
http://localhost:8075/api/login
```
Тело запроса должно содержать имя и пароль пользователя.  
Вот пример авторизации пользователя с именем "test" и паролем "test"
```json
{
    "username": "test",
    "password": "test"
}
```  
Если пользователь с таким именем и паролем есть в базе, то в ответ должен прийти json с именем и токеном.  
Пример  
```json
{
    "username": "test",
    "token": "eyJhbGciOiJIUzIeyJzdWIiOiJpdmFuIiwicm9sZXMiOlsiUk9MRV9VU0VSIl0"
}

```  
Для дальнейших запросов мы должны вставлять этот токен в Headers под именем Auth и в формате:  
 "Bearer_ + <токен>"  
Header из примера будет выглядеть так "Bearer_eyJhbGciOiJIUzIeyJzdWIiOiJpdmFuIiwicm9sZXMiOlsiUk9MRV9VU0VSIl0"
### Просмотр списка товаров/заказов
Для просмотра всех товаров нужно выполнить запрос на адрес "/products".  
Для просмотра всех заказов "/orders".
### Просмотр/добавление/изменение/удаление товара
Используются GET/POST/PUT/DELETE запросы соответственно.  
Для POST запроса в тело необходимо помещать JSON объект с соответствующими полями и отправлять на адрес "/products/new" или "/orders/new".  
Вот пример для "/products/new"  
```json
{
    "name": "tea",
    "price": 120
}
```  
Вот пример для "/orders/new"  
```json
{
    "orderedTime": "2022-01-01T12:00:00",
    "status": "wait",
    "productId": [1, 2]
}
```
GET/PUT/DETETE запросы осуществляются по адресам "/products/{id}" или "/orders/{id}" соответственно, где вместо {id} вписываем номер продукта/заказа.
(Для PUT запроса так же в теле отправляется json с изменяемыми полями)  
## 6. Структура проекта
Backend-часть представляет собой небольшое приложение, созданное на Spring Boot, основной целью которого является обработка запросов на получение, сохранение и удаление данных.
### Компоненты приложения  
#### Repositories  
Отвечают за доступ к БД и реализуют базовые CRUD-операции. Является поставщиком функционала для сервисов.

У каждой ORM-сущности (см. ниже) собственный репозиторий.  
#### Services  
Являются промежуточным уровнем между БД и потребителями данных. Предоставляют основной функционал для доступа к данным внутри бэкенда. Расширяют функционал работы с БД; методы сервисов отвечают за выполнение и откат транзакций.

Каждый сервис отвечает за доступ к данным одной сущности. Например, OrderService предоставляет методы для работы с сущностью Order.  
#### Controllers  
Связывают backend-часть с frontend-частью или сторонними приложениями. Предоставляют API для доступа к данным извне.  
### База данных
Схема  
![Image alt](https://github.com/uzivan/stock/blob/main/bd.jpg)
  
| Отношение     | Описание                                    |
|---------------|---------------------------------------------|
| users         | Содержит информацию о пользователях         |
| roles         | Содержит список ролей пользователей         |
| user_roles    | Содержит информацию о ролях пользовалелей   |
| orders        | Содержит информацию о заказах               |
| order_products| Содержит информацию о о продуктах в заказах |
| products      | Содержит информацию о продуктах             |
